<ion-content color="light">
  <ion-list *ngIf="segment === 'chats' && (conversations) as rooms">
    <ion-list-header class="ion-padding-bottom"> Messages </ion-list-header>

    <ion-item
      *ngFor="let item of rooms"
      (click)="getChat(item)"
      [detail]="true">
      <ng-container *ngIf="(item&& item.members)">
        <ion-avatar slot="start">
          <img
            [src]="item?.members[1].photoURL!==''&&item?.members[1].photoURL!==null? item?.members[1].photoURL:placeholderImgUrl" />
        </ion-avatar>
        <ion-label>
          {{item?.members[1].displayName}}
          <p>
            <ion-text>
              {{(item?.messages).length>0?
              item?.messages.at(-1).content.textData: ''}}
            </ion-text>
          </p>
        </ion-label>
        <ion-text slot="end" color="medium">
          {{(item?.messages).length>0?
          toDateTime(item?.messages.at(-1).metaData.timePosted.seconds):
          ''}}</ion-text
        >
      </ng-container>
    </ion-item>
  </ion-list>

  <ion-fab style="position: fixed" horizontal="end" vertical="bottom">
    <ion-fab-button (click)="newChatModalOpen()">
      <ion-icon name="chatbubbles"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-modal
    #new_chat
    [isOpen]="open_new_chat"
    (willDismiss)="onWillDismiss($event)">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>New Chat</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cancel()">Cancel</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content color="light" *ngIf="users as user$">
        <ion-list
          class="ion-margin-top"
          [style.background]="'transparent'"
          lines="none">
          <app-user-list
            *ngFor="let item of user$"
            [item]="item"
            (onUserPicked)="startChat($event)">
          </app-user-list>
          <!-- <app-user-list
            *ngFor="let item of userNew$|keyvalue"
            [item]="item"
            (click)="startChat($event)">
          </app-user-list> -->
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
